<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prediction Result - Earthquake Alert</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: 'Roboto', sans-serif; background-color: #f5f5f5; }
#map { height: 700px; margin-bottom: 20px; }
.card { margin-bottom: 15px; }
.alert-box { padding: 15px; border-radius: 5px; color: #fff; text-align: center; font-weight: bold; font-size:1.3rem; }
</style>
</head>
<body>
<div class="container mt-4">

<!-- Predicted Alert -->
<div class="row mb-3">
  <div class="col-md-12">
    <div class="alert-box" style="background-color: {% if alert=='Green' %}#28a745{% elif alert=='Yellow' %}#ffc107{% elif alert=='Orange' %}#fd7e14{% else %}#dc3545{% endif %};">
      Predicted Alert: {{ alert }} (Confidence: {{ confidence*100|round(1) }}%)
    </div>
  </div>
</div>

<!-- Probabilities -->
<div class="row">
  {% for key, val in prob.items() %}
  <div class="col-md-3">
    <div class="card text-center" style="background-color: {% if key=='Green' %}#28a745{% elif key=='Yellow' %}#ffc107{% elif key=='Orange' %}#fd7e14{% else %}#dc3545{% endif %}; color:white;">
      <div class="card-body">
        <h5>{{ key }}</h5>
        <p>{{ (val*100)|round(1) }}%</p>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Input Data -->
<div class="card mt-3 p-3">
  <h5>Input Data</h5>
  <div class="row">
    <div class="col-md-4"><strong>Magnitude:</strong> {{ magnitude }}</div>
    <div class="col-md-4"><strong>Depth:</strong> {{ depth }} km</div>
    <div class="col-md-4"><strong>Latitude:</strong> {{ latitude }}</div>
    <div class="col-md-4"><strong>Longitude:</strong> {{ longitude }}</div>
    <div class="col-md-4"><strong>Location:</strong> {{ loc_enc }}</div>
  </div>

  <!-- Collapsible Advanced Inputs -->
  <button class="btn btn-info mt-2 mb-2 w-100" type="button" data-bs-toggle="collapse" data-bs-target="#advancedInputs">
    Show/Hide Advanced Inputs
  </button>
  <div id="advancedInputs" class="collapse">
    <div class="row">
      <div class="col-md-4"><strong>NST:</strong> {{ nst }}</div>
      <div class="col-md-4"><strong>GAP:</strong> {{ gap }}</div>
      <div class="col-md-4"><strong>Dmin:</strong> {{ dmin }}</div>
      <div class="col-md-4"><strong>RMS:</strong> {{ rms }}</div>
      <div class="col-md-4"><strong>Mag Error:</strong> {{ magError }}</div>
      <div class="col-md-4"><strong>Depth Error:</strong> {{ depthError }}</div>
      <div class="col-md-4"><strong>Mag NST:</strong> {{ magNst }}</div>
    </div>
  </div>
</div>

<!-- Map -->
<div id="map"></div>

<!-- Alert Summary Chart -->
<div class="card mt-3 p-3">
  <h5>Alert Summary Chart</h5>
  <canvas id="alertChart" height="200"></canvas>
</div>

<!-- Back Button -->
<div class="text-center mb-4">
  <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Input</a>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Map
var map = L.map('map').setView([{{ latitude }}, {{ longitude }}], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom: 18 }).addTo(map);

// Marker
var alertColor = "{% if alert=='Green' %}green{% elif alert=='Yellow' %}yellow{% elif alert=='Orange' %}orange{% else %}red{% endif %}";
var circle = L.circle([{{ latitude }}, {{ longitude }}], {
    color: alertColor,
    fillColor: alertColor,
    fillOpacity: 0.5,
    radius: 5000
}).addTo(map);
circle.bindPopup("<b>{{ alert }}</b><br>Confidence: {{ (confidence*100)|round(1) }}%").openPopup();

// Chart.js Alert Summary
var ctx = document.getElementById('alertChart').getContext('2d');
var alertChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Green', 'Yellow', 'Orange', 'Red'],
        datasets: [{
            label: 'Number of Alerts',
            data: [
                {{ summary['Green'] }},
                {{ summary['Yellow'] }},
                {{ summary['Orange'] }},
                {{ summary['Red'] }}
            ],
            backgroundColor: ['#28a745','#ffc107','#fd7e14','#dc3545']
        }]
    },
    options: { responsive:true, plugins:{legend:{display:false}}, scales:{ y:{beginAtZero:true} } }
});
</script>
</body>
</html>








